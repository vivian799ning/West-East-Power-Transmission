# äº‘å—çœæ²³æµæ°´ä½ä¸å‘ç”µé‡ç›¸å…³æ€§åˆ†æ - Streamlit åº”ç”¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

é¦–å…ˆï¼Œç¡®ä¿ä½ å·²å®‰è£… Python 3.8+ï¼Œç„¶åå®‰è£…æ‰€éœ€çš„åŒ…ï¼š

```bash
pip install streamlit pandas numpy pymysql plotly scipy scikit-learn openpyxl
```

### 2. è¿è¡Œåº”ç”¨

åœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œï¼š

```bash
cd yunnan_river_app
streamlit run app.py
```

è¿è¡Œåï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ `http://localhost:8501`ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°åº”ç”¨ç•Œé¢äº†ã€‚

---

## ğŸ“– Streamlit åŸºç¡€æ•™ç¨‹

### ä»€ä¹ˆæ˜¯ Streamlitï¼Ÿ

Streamlit æ˜¯ä¸€ä¸ª Python åº“ï¼Œå¯ä»¥è®©ä½ ç”¨çº¯ Python ä»£ç å¿«é€Ÿåˆ›å»ºäº¤äº’å¼ Web åº”ç”¨ã€‚ä½ ä¸éœ€è¦å­¦ä¹  HTMLã€CSSã€JavaScriptï¼Œåªéœ€è¦å†™ Python ä»£ç å°±èƒ½åˆ›å»ºæ¼‚äº®çš„æ•°æ®åº”ç”¨ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

#### 1. ä»£ç å³ç•Œé¢
Streamlit çš„ä»£ç ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œæ¯æ¬¡ç”¨æˆ·äº¤äº’éƒ½ä¼šé‡æ–°è¿è¡Œæ•´ä¸ªè„šæœ¬ã€‚

```python
import streamlit as st

st.title("æˆ‘çš„ç¬¬ä¸€ä¸ªåº”ç”¨")      # æ˜¾ç¤ºæ ‡é¢˜
st.write("Hello, World!")      # æ˜¾ç¤ºæ–‡æœ¬
```

#### 2. å¸¸ç”¨ç»„ä»¶

| ç»„ä»¶ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `st.title()` | å¤§æ ‡é¢˜ | `st.title("æ ‡é¢˜")` |
| `st.header()` | å°æ ‡é¢˜ | `st.header("å‰¯æ ‡é¢˜")` |
| `st.text()` | çº¯æ–‡æœ¬ | `st.text("æ–‡æœ¬")` |
| `st.markdown()` | Markdown | `st.markdown("**ç²—ä½“**")` |
| `st.dataframe()` | æ•°æ®è¡¨æ ¼ | `st.dataframe(df)` |
| `st.metric()` | æŒ‡æ ‡å¡ç‰‡ | `st.metric("æŒ‡æ ‡", 100)` |
| `st.plotly_chart()` | Plotly å›¾è¡¨ | `st.plotly_chart(fig)` |

#### 3. äº¤äº’ç»„ä»¶

```python
# æŒ‰é’®
if st.button("ç‚¹å‡»æˆ‘"):
    st.write("æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼")

# é€‰æ‹©æ¡†
option = st.selectbox("é€‰æ‹©ä¸€ä¸ªé€‰é¡¹", ["é€‰é¡¹1", "é€‰é¡¹2", "é€‰é¡¹3"])

# å¤šé€‰æ¡†
options = st.multiselect("å¤šé€‰", ["A", "B", "C"], default=["A"])

# æ»‘å—
value = st.slider("é€‰æ‹©æ•°å€¼", 0, 100, 50)

# æ—¥æœŸé€‰æ‹©
date = st.date_input("é€‰æ‹©æ—¥æœŸ")
```

#### 4. å¸ƒå±€ç»„ä»¶

```python
# ä¾§è¾¹æ 
st.sidebar.title("ä¾§è¾¹æ ")
st.sidebar.selectbox("é€‰æ‹©", ["A", "B"])

# åˆ—å¸ƒå±€
col1, col2 = st.columns(2)
with col1:
    st.write("å·¦åˆ—å†…å®¹")
with col2:
    st.write("å³åˆ—å†…å®¹")

# æ ‡ç­¾é¡µ
tab1, tab2 = st.tabs(["æ ‡ç­¾1", "æ ‡ç­¾2"])
with tab1:
    st.write("æ ‡ç­¾1å†…å®¹")
with tab2:
    st.write("æ ‡ç­¾2å†…å®¹")

# å±•å¼€æ¡†
with st.expander("ç‚¹å‡»å±•å¼€"):
    st.write("éšè—çš„å†…å®¹")
```

#### 5. ç¼“å­˜æœºåˆ¶

ä½¿ç”¨ `@st.cache_data` è£…é¥°å™¨å¯ä»¥ç¼“å­˜å‡½æ•°ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ï¼š

```python
@st.cache_data(ttl=3600)  # ç¼“å­˜1å°æ—¶
def load_data():
    # è€—æ—¶çš„æ•°æ®åŠ è½½æ“ä½œ
    return pd.read_csv("data.csv")
```

---

## ğŸ”§ ä»£ç ä¿®æ”¹æŒ‡å—

### é¡¹ç›®ç»“æ„

```
yunnan_river_app/
â”œâ”€â”€ app.py              # ä¸»åº”ç”¨æ–‡ä»¶ï¼ˆâ­ ä¸»è¦ä¿®æ”¹è¿™ä¸ªï¼‰
â”œâ”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
â””â”€â”€ config.py           # é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
```

### å¸¸è§ä¿®æ”¹åœºæ™¯

#### åœºæ™¯1ï¼šä¿®æ”¹æ•°æ®åº“è¿æ¥

æ‰¾åˆ° `load_river_data()` å‡½æ•°ï¼ˆçº¦ç¬¬60è¡Œï¼‰ï¼š

```python
@st.cache_data(ttl=3600)
def load_river_data():
    conn = pymysql.connect(
        host="ä½ çš„æ•°æ®åº“åœ°å€",      # â† ä¿®æ”¹è¿™é‡Œ
        port=3306,
        database="æ•°æ®åº“å",        # â† ä¿®æ”¹è¿™é‡Œ
        charset="utf8",
        user="ç”¨æˆ·å",              # â† ä¿®æ”¹è¿™é‡Œ
        passwd="å¯†ç "               # â† ä¿®æ”¹è¿™é‡Œ
    )
```

#### åœºæ™¯2ï¼šä¿®æ”¹å‘ç”µæ•°æ®æ–‡ä»¶è·¯å¾„

æ‰¾åˆ° `load_power_data()` å‡½æ•°ï¼ˆçº¦ç¬¬85è¡Œï¼‰ï¼š

```python
@st.cache_data(ttl=3600)
def load_power_data():
    df = pd.read_excel('/ä½ çš„æ–‡ä»¶è·¯å¾„/chushui.xlsx')  # â† ä¿®æ”¹è¿™é‡Œ
```

#### åœºæ™¯3ï¼šæ·»åŠ æ–°çš„é¢„è®¾æ²³æµç»„

æ‰¾åˆ° Tab 2 ä¸­çš„é¢„è®¾å®šä¹‰ï¼ˆçº¦ç¬¬280è¡Œï¼‰ï¼š

```python
# æ·»åŠ æ–°çš„æ²³æµç»„
my_rivers = ['æ²³æµ1', 'æ²³æµ2', 'æ²³æµ3']  # â† æ·»åŠ ä½ çš„æ²³æµç»„

# æ·»åŠ æŒ‰é’®
with preset_col1:
    if st.button("æˆ‘çš„æ²³æµç»„"):
        selected_rivers = [r for r in my_rivers if r in all_rivers]
        st.rerun()
```

#### åœºæ™¯4ï¼šä¿®æ”¹å›¾è¡¨æ ·å¼

æ‰¾åˆ°ç»˜å›¾å‡½æ•° `plot_timeseries()` æˆ– `plot_scatter()`ï¼ˆçº¦ç¬¬120-180è¡Œï¼‰ï¼š

```python
def plot_timeseries(df_merged, river_name, stats=None):
    fig = make_subplots(specs=[[{"secondary_y": True}]])
    
    # ä¿®æ”¹é¢œè‰²
    fig.add_trace(
        go.Scatter(
            x=df_merged['date'],
            y=df_merged['power_sum'],
            name='æ—¥å‘ç”µé‡(MWh)',
            line=dict(color='#1f77b4', width=1.5),  # â† ä¿®æ”¹é¢œè‰²å’Œçº¿å®½
            opacity=0.8
        ),
        secondary_y=False
    )
```

#### åœºæ™¯5ï¼šæ·»åŠ æ–°çš„åˆ†æåŠŸèƒ½

åœ¨ `main()` å‡½æ•°ä¸­æ·»åŠ æ–°çš„æ ‡ç­¾é¡µï¼š

```python
# åœ¨ç°æœ‰tabsä¸­æ·»åŠ æ–°æ ‡ç­¾
tab1, tab2, tab3, tab4, tab5 = st.tabs([
    "ğŸ“Š å•æ¡æ²³æµåˆ†æ", 
    "ğŸ”— å¤šæ²³æµç»„åˆåˆ†æ", 
    "ğŸ“ˆ æ‰€æœ‰æ²³æµæ±‡æ€»",
    "ğŸ“‹ æ•°æ®æ€»è§ˆ",
    "ğŸ†• æˆ‘çš„æ–°åŠŸèƒ½"  # â† æ·»åŠ æ–°æ ‡ç­¾
])

# æ·»åŠ æ–°æ ‡ç­¾çš„å†…å®¹
with tab5:
    st.header("æˆ‘çš„æ–°åŠŸèƒ½")
    # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ä»£ç 
```

#### åœºæ™¯6ï¼šä¿®æ”¹æ—¶é—´èŒƒå›´é»˜è®¤å€¼

æ‰¾åˆ°ä¾§è¾¹æ çš„æ—¶é—´é€‰æ‹©éƒ¨åˆ†ï¼ˆçº¦ç¬¬220è¡Œï¼‰ï¼š

```python
start_date = st.date_input(
    "å¼€å§‹æ—¥æœŸ",
    value=datetime(2021, 1, 1),   # â† ä¿®æ”¹é»˜è®¤å¼€å§‹æ—¥æœŸ
    min_value=datetime(2020, 1, 1),
    max_value=datetime(2025, 12, 31)
)
```

---

## ğŸ’¡ ä¿®æ”¹åå¦‚ä½•ç”Ÿæ•ˆï¼Ÿ

Streamlit å…·æœ‰ **çƒ­é‡è½½** åŠŸèƒ½ï¼š

1. **è‡ªåŠ¨æ£€æµ‹**ï¼šä¿å­˜æ–‡ä»¶åï¼ŒStreamlit ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°å˜åŒ–
2. **ç‚¹å‡»åˆ·æ–°**ï¼šé¡µé¢å³ä¸Šè§’ä¼šå‡ºç° "Rerun" æŒ‰é’®ï¼Œç‚¹å‡»å³å¯
3. **è‡ªåŠ¨åˆ·æ–°**ï¼šä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ å‚æ•° `streamlit run app.py --server.runOnSave true`

### å¼€å‘æ¨¡å¼å»ºè®®

```bash
# å¼€å¯è‡ªåŠ¨ä¿å­˜åˆ·æ–°
streamlit run app.py --server.runOnSave true

# æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
# åˆ›å»º .streamlit/config.toml
[server]
runOnSave = true
```

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### app.py ä»£ç ç»“æ„

```
app.py
â”‚
â”œâ”€â”€ å¯¼å…¥æ¨¡å— (ç¬¬1-20è¡Œ)
â”‚   â””â”€â”€ streamlit, pandas, plotly, scipy ç­‰
â”‚
â”œâ”€â”€ é¡µé¢é…ç½® (ç¬¬25-35è¡Œ)
â”‚   â””â”€â”€ st.set_page_config()
â”‚
â”œâ”€â”€ è‡ªå®šä¹‰CSSæ ·å¼ (ç¬¬40-60è¡Œ)
â”‚   â””â”€â”€ st.markdown() with CSS
â”‚
â”œâ”€â”€ æ•°æ®åŠ è½½å‡½æ•° (ç¬¬65-130è¡Œ)
â”‚   â”œâ”€â”€ load_river_data()      # ä»æ•°æ®åº“åŠ è½½æ²³æµæ•°æ®
â”‚   â”œâ”€â”€ load_power_data()      # åŠ è½½å‘ç”µæ•°æ®
â”‚   â”œâ”€â”€ process_water_data()   # å¤„ç†æ°´ä½æ•°æ®
â”‚   â””â”€â”€ calculate_correlation() # è®¡ç®—ç›¸å…³æ€§
â”‚
â”œâ”€â”€ ç»˜å›¾å‡½æ•° (ç¬¬135-200è¡Œ)
â”‚   â”œâ”€â”€ plot_timeseries()      # æ—¶åºå›¾
â”‚   â””â”€â”€ plot_scatter()         # æ•£ç‚¹å›¾
â”‚
â””â”€â”€ ä¸»å‡½æ•° main() (ç¬¬205-400è¡Œ)
    â”œâ”€â”€ ä¾§è¾¹æ å‚æ•°è®¾ç½®
    â”œâ”€â”€ Tab 1: å•æ¡æ²³æµåˆ†æ
    â”œâ”€â”€ Tab 2: å¤šæ²³æµç»„åˆåˆ†æ
    â”œâ”€â”€ Tab 3: æ‰€æœ‰æ²³æµæ±‡æ€»
    â””â”€â”€ Tab 4: æ•°æ®æ€»è§ˆ
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥ç½‘ç»œæ˜¯å¦èƒ½è®¿é—®æ•°æ®åº“æœåŠ¡å™¨
- ç¡®è®¤ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ•°æ®åº“ç«¯å£æ˜¯å¦å¼€æ”¾

### Q2: å›¾è¡¨ä¸æ˜¾ç¤º
- ç¡®ä¿å®‰è£…äº† plotly: `pip install plotly`
- æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºç©º

### Q3: ä¸­æ–‡æ˜¾ç¤ºä¹±ç 
- Plotly é»˜è®¤æ”¯æŒä¸­æ–‡ï¼Œæ— éœ€é¢å¤–é…ç½®
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥æ•°æ®ç¼–ç 

### Q4: é¡µé¢åŠ è½½å¾ˆæ…¢
- ä½¿ç”¨ `@st.cache_data` ç¼“å­˜æ•°æ®
- å‡å°‘ä¸€æ¬¡æ€§åŠ è½½çš„æ•°æ®é‡
- è€ƒè™‘åˆ†é¡µæ˜¾ç¤º

---

## ğŸ“ æ›´å¤šå¸®åŠ©

- Streamlit å®˜æ–¹æ–‡æ¡£: https://docs.streamlit.io
- Plotly å›¾è¡¨åº“: https://plotly.com/python/
- å¦‚æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­å‘æˆ‘æé—®ï¼
